<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste NDD Cargo API - Roteirizador</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        .header p {
            opacity: 0.9;
            font-size: 14px;
        }
        .content {
            padding: 30px;
        }
        .section {
            margin-bottom: 30px;
        }
        .section h2 {
            color: #667eea;
            font-size: 20px;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        .form-group {
            display: flex;
            flex-direction: column;
        }
        .form-group label {
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            font-size: 14px;
        }
        .form-group input, .form-group select {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
        }
        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
        }
        .checkbox-group input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }
        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        .btn-secondary {
            background: #f0f0f0;
            color: #333;
        }
        .btn-secondary:hover {
            background: #e0e0e0;
        }
        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        .response-box {
            background: #f8f9fa;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            min-height: 150px;
            max-height: 500px;
            overflow-y: auto;
        }
        .response-box pre {
            margin: 0;
            white-space: pre-wrap;
            word-wrap: break-word;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.6;
        }
        .loading {
            text-align: center;
            padding: 40px;
            color: #667eea;
        }
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .success {
            color: #28a745;
            font-weight: 600;
        }
        .error {
            color: #dc3545;
            font-weight: 600;
        }
        .info-box {
            background: #e7f3ff;
            border-left: 4px solid #667eea;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .info-box p {
            margin: 5px 0;
            font-size: 14px;
            color: #333;
        }
        .info-box strong {
            color: #667eea;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöõ NDD Cargo API - Teste de Roteiriza√ß√£o</h1>
            <p>Mesmos par√¢metros do script nteste.py</p>
        </div>

        <div class="content">
            <!-- Info Box -->
            <div class="info-box">
                <p><strong>Ambiente:</strong> Homologa√ß√£o NDD Cargo</p>
                <p><strong>Endpoint:</strong> https://homologa.nddcargo.com.br/wsagente/ExchangeMessage.asmx</p>
                <p><strong>Protocolo:</strong> CrossTalk sobre SOAP 1.1 com assinatura digital RSA-SHA1</p>
            </div>

            <!-- Form Section -->
            <div class="section">
                <h2>üìã Par√¢metros da Consulta</h2>

                <div class="form-grid">
                    <div class="form-group">
                        <label>CNPJ Empresa:</label>
                        <input type="text" id="cnpj_empresa" value="17359233000188" readonly>
                    </div>
                    <div class="form-group">
                        <label>CNPJ Contratante:</label>
                        <input type="text" id="cnpj_contratante" value="17359233000188" readonly>
                    </div>
                    <div class="form-group">
                        <label>Categoria Ped√°gio:</label>
                        <select id="categoria_pedagio">
                            <option value="1">1 - Motocicleta</option>
                            <option value="2">2 - Autom√≥vel</option>
                            <option value="3">3 - 2 eixos</option>
                            <option value="4">4 - 3 eixos</option>
                            <option value="5">5 - 4 eixos</option>
                            <option value="6">6 - 5 eixos</option>
                            <option value="7" selected>7 - 6 eixos</option>
                        </select>
                    </div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label>CEP Origem:</label>
                        <input type="text" id="cep_origem" value="88508320" placeholder="88508320">
                    </div>
                    <div class="form-group">
                        <label>CEP Destino:</label>
                        <input type="text" id="cep_destino" value="01218020" placeholder="01218020">
                    </div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label>Tipo Rota Padr√£o:</label>
                        <select id="tipo_rota_padrao">
                            <option value="1" selected>1 - Rota R√°pida</option>
                            <option value="2">2 - Rota Curta</option>
                            <option value="3">3 - Rota Econ√¥mica</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Tipo Rota:</label>
                        <select id="tipo_rota">
                            <option value="1" selected>1 - Normal</option>
                            <option value="2">2 - Alternativa</option>
                            <option value="3">3 - Customizada</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Tipo Ve√≠culo:</label>
                        <select id="tipo_veiculo">
                            <option value="1">1 - Moto</option>
                            <option value="2" selected>2 - Caminh√£o</option>
                            <option value="3">3 - Carreta</option>
                            <option value="4">4 - Bitrem</option>
                            <option value="5">5 - Rodotrem</option>
                        </select>
                    </div>
                </div>

                <div class="checkbox-group">
                    <input type="checkbox" id="evitar_pedagogios">
                    <label for="evitar_pedagogios">Evitar Ped√°gios</label>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="priorizar_rodovias" checked>
                    <label for="priorizar_rodovias">Priorizar Rodovias</label>
                </div>
                <div class="checkbox-group">
                    <input type="checkbox" id="retornar_trecho" checked>
                    <label for="retornar_trecho">Retornar Trechos Detalhados</label>
                </div>

                <div class="button-group">
                    <button class="btn btn-primary" onclick="consultarRoteirizador()">
                        üöÄ Consultar Roteirizador
                    </button>
                    <button class="btn btn-secondary" onclick="testarConexao()">
                        üîå Testar Conex√£o
                    </button>
                    <button class="btn btn-secondary" onclick="limparResposta()">
                        üóëÔ∏è Limpar
                    </button>
                </div>
            </div>

            <!-- Response Section -->
            <div class="section">
                <h2>üì§ Resposta da API</h2>
                <div id="response" class="response-box">
                    <p style="color: #999; text-align: center;">Aguardando requisi√ß√£o...</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8002/api/ndd-cargo';

        async function consultarRoteirizador() {
            const responseDiv = document.getElementById('response');

            // Show loading
            responseDiv.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Enviando requisi√ß√£o para NDD Cargo...</p>
                    <p style="font-size: 12px; color: #999;">Aguarde, isso pode levar alguns segundos</p>
                </div>
            `;

            const data = {
                cnpj_empresa: document.getElementById('cnpj_empresa').value,
                cnpj_contratante: document.getElementById('cnpj_contratante').value,
                categoria_pedagio: parseInt(document.getElementById('categoria_pedagio').value),
                pontos_parada: {
                    origem: document.getElementById('cep_origem').value,
                    destino: document.getElementById('cep_destino').value
                },
                tipo_rota_padrao: parseInt(document.getElementById('tipo_rota_padrao').value),
                evitar_pedagogios: document.getElementById('evitar_pedagogios').checked,
                priorizar_rodovias: document.getElementById('priorizar_rodovias').checked,
                tipo_rota: parseInt(document.getElementById('tipo_rota').value),
                tipo_veiculo: parseInt(document.getElementById('tipo_veiculo').value),
                retornar_trecho: document.getElementById('retornar_trecho').checked
            };

            try {
                const startTime = performance.now();
                const response = await fetch(`${API_BASE}/roteirizador`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify(data)
                });

                const endTime = performance.now();
                const duration = ((endTime - startTime) / 1000).toFixed(2);

                const result = await response.json();

                let html = `
                    <div style="margin-bottom: 20px;">
                        <p class="${result.success ? 'success' : 'error'}">
                            ${result.success ? '‚úÖ Sucesso!' : '‚ùå Erro!'}
                            (${response.status} - ${duration}s)
                        </p>
                    </div>
                `;

                if (result.success && result.data) {
                    const dados = result.data;
                    html += `
                        <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                            <h3 style="color: #667eea; margin-bottom: 10px;">üìä Resumo da Rota:</h3>
                            <p><strong>Status:</strong> ${dados.mensagem}</p>
                            <p><strong>Dist√¢ncia:</strong> ${dados.distancia_km} km</p>
                            <p><strong>Tempo:</strong> ${dados.tempo_minutos} minutos</p>
                            <p><strong>Valor Total Ped√°gios:</strong> R$ ${dados.valor_total_pedagogios.toFixed(2)}</p>
                            <p><strong>Quantidade de Pra√ßas:</strong> ${dados.quantidade_pracas}</p>
                        </div>
                    `;

                    if (dados.pracas_pedagio && dados.pracas_pedagio.length > 0) {
                        html += `
                            <div style="background: white; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                                <h3 style="color: #667eea; margin-bottom: 10px;">üõ£Ô∏è Pra√ßas de Ped√°gio:</h3>
                                ${dados.pracas_pedagio.map((praca, i) => `
                                    <div style="padding: 10px; background: #f8f9fa; margin: 5px 0; border-radius: 5px;">
                                        <p><strong>${i + 1}. ${praca.nome}</strong></p>
                                        <p>Rodovia: ${praca.rodovia} | Valor: R$ ${praca.valor.toFixed(2)}</p>
                                    </div>
                                `).join('')}
                            </div>
                        `;
                    }
                }

                html += `
                    <details style="margin-top: 15px;">
                        <summary style="cursor: pointer; color: #667eea; font-weight: 600; padding: 10px; background: #f8f9fa; border-radius: 5px;">
                            üìÑ JSON Completo
                        </summary>
                        <pre style="margin-top: 10px; background: #282c34; color: #61dafb; padding: 15px; border-radius: 8px; overflow-x: auto;">${JSON.stringify(result, null, 2)}</pre>
                    </details>
                `;

                responseDiv.innerHTML = html;

            } catch (error) {
                responseDiv.innerHTML = `
                    <div class="error">
                        <p>‚ùå Erro na requisi√ß√£o:</p>
                        <pre>${error.message}</pre>
                    </div>
                `;
            }
        }

        async function testarConexao() {
            const responseDiv = document.getElementById('response');

            responseDiv.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Testando conex√£o...</p>
                </div>
            `;

            try {
                const response = await fetch(`${API_BASE}/test-connection`);
                const result = await response.json();

                let html = `
                    <div class="${result.success ? 'success' : 'error'}">
                        <p>${result.success ? '‚úÖ Conex√£o OK!' : '‚ùå Erro na Conex√£o'}</p>
                        <p>${result.message}</p>
                    </div>
                `;

                if (result.details) {
                    html += `
                        <div style="margin-top: 15px; background: white; padding: 15px; border-radius: 8px;">
                            <h3 style="color: #667eea;">Detalhes:</h3>
                            <pre>${JSON.stringify(result.details, null, 2)}</pre>
                        </div>
                    `;
                }

                responseDiv.innerHTML = html;

            } catch (error) {
                responseDiv.innerHTML = `
                    <div class="error">
                        <p>‚ùå Erro:</p>
                        <pre>${error.message}</pre>
                    </div>
                `;
            }
        }

        function limparResposta() {
            document.getElementById('response').innerHTML = `
                <p style="color: #999; text-align: center;">Aguardando requisi√ß√£o...</p>
            `;
        }
    </script>
</body>
</html>
