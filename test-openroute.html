<!DOCTYPE html>
<html>
<head>
    <title>Teste OpenRouteService</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.css" />
    <style>
        body { font-family: Arial; padding: 20px; }
        #map { height: 500px; width: 100%; margin-top: 20px; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <h1>Teste OpenRouteService - Automated</h1>
    <div id="status" class="status info">Iniciando teste...</div>
    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.js"></script>
    <script src="https://unpkg.com/@gegeweb/leaflet-routing-machine-openroute@0.1.10/dist/leaflet-routing-openroute.min.js"></script>

    <script>
        const statusDiv = document.getElementById('status');

        function updateStatus(message, type = 'info') {
            console.log(message);
            statusDiv.textContent = message;
            statusDiv.className = 'status ' + type;
        }

        try {
            updateStatus('✓ Step 1: Verificando libraries...', 'info');

            if (typeof L === 'undefined') {
                updateStatus('✗ ERRO: Leaflet não carregou', 'error');
                throw new Error('Leaflet não carregado');
            }

            if (typeof L.Routing === 'undefined') {
                updateStatus('✗ ERRO: Leaflet Routing Machine não carregou', 'error');
                throw new Error('Leaflet Routing Machine não carregado');
            }

            if (typeof L.Routing.openrouteservice === 'undefined') {
                updateStatus('✗ ERRO: OpenRouteService plugin não carregou', 'error');
                throw new Error('OpenRouteService plugin não carregado');
            }

            updateStatus('✓ Step 2: Todas as libraries carregadas! Criando mapa...', 'success');

            // Criar mapa
            const map = L.map('map').setView([-19.9191, -43.9386], 13);

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '© OpenStreetMap',
                maxZoom: 19,
            }).addTo(map);

            updateStatus('✓ Step 3: Mapa criado! Configurando OpenRouteService router...', 'info');

            // Criar router OpenRouteService
            const orsRouter = L.Routing.openrouteservice('5b3ce3597851110001cf6248b08a59258c184f5fab1b0c27a6c53cb7', {
                timeout: 30000,
                profile: 'driving-car'
            });

            updateStatus('✓ Step 4: Router configurado! Calculando rota entre 2 pontos em BH...', 'info');

            // Criar rota simples
            L.Routing.control({
                waypoints: [
                    L.latLng(-19.9191, -43.9386), // Ponto A em BH
                    L.latLng(-19.9227, -43.9450)  // Ponto B em BH (5km de distância)
                ],
                router: orsRouter,
                routeWhileDragging: false
            }).on('routesfound', function(e) {
                const route = e.routes[0];
                const distance = (route.summary.totalDistance / 1000).toFixed(1);
                const time = Math.round(route.summary.totalTime / 60);

                updateStatus(`✓ SUCCESS! Rota calculada: ${distance} km, ${time} min - OpenRouteService funcionando perfeitamente!`, 'success');
                console.log('✓ Rota completa:', route);
            }).on('routingerror', function(e) {
                updateStatus(`✗ ERRO no routing: ${e.error ? e.error.message : JSON.stringify(e)}`, 'error');
                console.error('✗ Erro completo:', e);
            }).addTo(map);

        } catch (error) {
            updateStatus(`✗ EXCEÇÃO: ${error.message}`, 'error');
            console.error('✗ Exceção completa:', error);
        }
    </script>
</body>
</html>
